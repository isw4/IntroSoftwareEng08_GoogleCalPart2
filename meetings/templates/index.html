<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html lang="en"> 
<head>
  <title>Meeting Busy and Free Times</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css"
    href="//cdn.jsdelivr.net/bootstrap/latest/css/bootstrap.css"/>

  <link rel="stylesheet" type="text/css"
    href="/static/css/busy.css"/>

  <!-- jquery from a content distribution network; probably cached -->
  <script type="text/javascript"
    src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

  <!-- Ideally the rest of our javascript dependencies would be
       bundled and minified with 'browserify', but I've found that
       it difficult to handle browserify dependencies for class
       projects.  So, we'll pick up moment and a date range picker
       from CDNs instead.
  -->
  <script type="text/javascript" 
    src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

  <script type="text/javascript" 
    src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
  <link rel="stylesheet" type="text/css" 
    href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
</head>

<body>
<div class="container">

<h1>Busy times</h1>

{% if g.calendars is defined %}
  <p>Logged in as:</p>
{% else %}
  <p>Not logged in</p>
{% endif %}

<form action="/setrange" method="post" id="daterangeform">
  <label for="daterange">Date Range</label>
  <input type="text" name="daterange" size="13"
    {% if session.daterange is defined %}
      value="{{session.daterange}}"
    {% endif %}
    class="pull-down"
    style="background: #fff; cursor: pointer; padding: 5px 10px;
    border: 1px solid #ccc; width: 12em" >
  <script type="text/javascript">
  $(function() {
  $('input[name="daterange"]').daterangepicker(
    {    ranges: {
           'Today': [moment(), moment()],
           'Tomorrow':[moment().add(1, 'days'),
                       moment().add(1, 'days')], 
           'This week':[moment(), moment().endOf('week')],
           'Next week':[moment().add(7, 'days').startOf('week'),
                        moment().add(7, 'days').endOf('week')],
           'This month':[moment(), moment().endOf('month')],
           'Within two weeks':[moment(),moment().add(15, 'days')]
        }}
       );
    });
  </script>
  <input type="submit" value="Submit Range" />
</form>

{% if g.calendars is not defined %}

<div id="content">
  <p id="description">Some description about the app and data range picker</p>

</div>


{% else %}
  
  <div class="row">
  {% for cal in g.calendars if cal.selected %}
          <div class="col-md-4">
	   {{ cal.summary }}
          </div>
         {% if loop.index is divisibleby 3 %}
          </div> <div class="row">
         {% endif %}
  {% endfor %}
  </div>

{% endif %}
    

  </div>  <!-- container (for bootstrap) -->


<script type="text/javascript">
  // Sets up the event listeners when the page is first loaded(not logged in)
  $(document).ready(function(){

    // Sets up event listener for the date range picker
    $("#daterangeform").submit(function(event){
      event.preventDefault();

      $.post("/submitdaterange", $(this).serialize(),
        function(data){
          console.log(data.result.success);

          if (!$("#calendardisplay").length) {
            //if calendar display does not exist
            console.log("display does not exist. clearing description.");
            $("#description").fadeOut();
            console.log("Showing calendars");
            $("#content").appendChild("<p>Calendar</p>");
          }
        } //end response to ajax return
      ) //end ajax post
    }) //end event listener for date range picker
  }) //end on document ready
</script>



</body>
</html>